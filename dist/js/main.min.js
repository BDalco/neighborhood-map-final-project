var data={locations:[{title:"Emporium Logan Square",location:{lat:41.9242,lng:-87.6993},place_id:"ChIJvxPg9mLND4gRZQkGFIME1b0"},{title:"Logan Arcade",location:{lat:41.9243734,lng:-87.6916102},place_id:"ChIJPUOMoprSD4gRf8R-f-It5HA"},{title:"Logan Hardware Records",location:{lat:41.9250107,lng:-87.6936709},place_id:"ChIJ9z8JoprSD4gRvkWDQVx0WeU"},{title:"Revolution Brewing",location:{lat:41.9235734,lng:-87.6990944},place_id:"ChIJsxosZWLND4gRH7vbeVKbuLg"},{title:"Slippery Slope",location:{lat:41.9239505,lng:-87.7001477},place_id:"ChIJdy7U9WLND4gRlsn7Bwe_NI8"},{title:"WhirlyBall Chicago",location:{lat:41.9213616,lng:-87.6801861},place_id:"ChIJ36q9du3SD4gRc_oBbj74Fm4"}]},stringHasText=function(e,o){return e=e||"",!(o.length>e.length)&&-1!==e.indexOf(o)},map,ViewModel=function(){var e=this;this.locationFilter=ko.observable(),this.items=ko.observableArray(data.locations),this.ph=ko.observable("Filter bars..."),this.filteredBars=ko.computed(function(){var e=this.locationFilter();return e?mapHandler.filterPage(ko.utils.arrayFilter(this.items(),function(o){return stringHasText(o.title.toLowerCase(),e.toLowerCase())})):mapHandler.filterPage(this.items())},this),this.reset=function(){e.locationFilter(null)}},mapHandler={bounds:null,infoWindow:null,map:null,markers:[],model:null,previousMarker:null,service:null,loadInfo:function(e,o,t,n){null!==mapHandler.previousMarker&&mapHandler.previousMarker.setIcon(null);var r='<div class="barContent">';o==google.maps.places.PlacesServiceStatus.OK&&(e.name?r+="<h3>"+e.name+"</h3>":r+="<h3>"+t.title+"</h3>",e.formatted_address?r+=e.formatted_address+"<br>":r+="<br>",e.formatted_phone_number?r+="<br><strong>Phone Number:</strong> "+e.formatted_phone_number+"<br>":r+="<br><strong>Phone Number</strong>: NONE<br>",e.opening_hours?r+="<br><strong>Hours:</strong><br>"+e.opening_hours.weekday_text[0]+"<br>"+e.opening_hours.weekday_text[1]+"<br>"+e.opening_hours.weekday_text[2]+"<br>"+e.opening_hours.weekday_text[3]+"<br>"+e.opening_hours.weekday_text[4]+"<br>"+e.opening_hours.weekday_text[5]+"<br>"+e.opening_hours.weekday_text[6]+"<br>":r+="<br>",e.rating?r+="<br><strong>Rating</strong>: "+e.rating+"<br>":r+="<br><strong>Rating</strong>: NONE<br>",e.website?r+='<br><a target="_blank" href="'+e.website+'">View Website</a><br>':r+="<br>No Website<br>",e.photos?r+='<br><img src="'+e.photos[0].getUrl({maxHeight:200,maxWidth:200})+'">':r+="<br>"),n.setContent(r),n.open(self.map,t),mapHandler.previousMarker=t},filterPage:function(e){var o=mapHandler,t=[];console.log(e),e.forEach(function(e){t.push(e.title)});for(var n=0;n<o.markers.length;n++)t.includes(o.markers[n].title)?o.markers[n].setVisible(!0):o.markers[n].setVisible(!1);return e},focusOnMarker:function(e){var o=mapHandler;if(null!==o.model&&o.model.reset(),null!==o.map)for(var t=new google.maps.LatLngBounds,n=0;n<o.markers.length;n++)"All bars"===e?(o.infoWindow.close(),o.markers[n].setVisible(!0),o.markers[n].setIcon(null),t.extend(o.markers[n].position)):e.title===o.markers[n].title&&(t.extend(o.markers[n].position),o.populateInfoWindow(o.markers[n],o.infoWindow))},populateInfoWindow:function(e,o){var t=this;if(o.marker!=e){o.marker=e;var n={placeId:e.place_id};t.service.getDetails(n,(n,r)=>t.loadInfo(n,r,e,o)),o.addListener("closeclick",function(){o.setMarker=null,e.setIcon(null),t.focusOnMarker("All bars"),t.map.fitBounds(t.bounds)})}},init:function(){var e=this;e.model=new ViewModel,ko.options.deferUpdates=!0,ko.applyBindings(this.model),e.map=new google.maps.Map(document.getElementById("map"),{center:{lat:41.9243734,lng:-87.6916102},zoom:1,mapTypeControl:!1}),e.service=new google.maps.places.PlacesService(e.map),e.infoWindow=new google.maps.InfoWindow,e.bounds=new google.maps.LatLngBounds;var o=0;data.locations.forEach(function(t){var n=new google.maps.Marker({map:e.map,position:t.location,title:t.title,animation:google.maps.Animation.DROP,place_id:t.place_id});o+=1,e.markers.push(n),n.addListener("click",function(){e.populateInfoWindow(this,e.infoWindow)}),e.bounds.extend(n.position)}),e.map.fitBounds(e.bounds)}};