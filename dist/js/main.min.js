function errorHandling(){alert("I am sorry, Google Maps has failed to load. Please check to be sure you are connected to the internet and try again.")}var data={locations:[{title:"Emporium Logan Square",location:{lat:41.9242,lng:-87.6993},place_id:"ChIJvxPg9mLND4gRZQkGFIME1b0",foursquare_id:"53c09447498e2e581dcab9ff"},{title:"Logan Arcade",location:{lat:41.9243734,lng:-87.6916102},place_id:"ChIJPUOMoprSD4gRf8R-f-It5HA",foursquare_id:"53015818498ee35b40b8892b"},{title:"Logan Hardware Records",location:{lat:41.9250107,lng:-87.6936709},place_id:"ChIJ9z8JoprSD4gRvkWDQVx0WeU",foursquare_id:"4b5378dff964a520a89e27e3"},{title:"Revolution Brewing",location:{lat:41.9235734,lng:-87.6990944},place_id:"ChIJsxosZWLND4gRH7vbeVKbuLg",foursquare_id:"4b0b3062f964a520582e23e3"},{title:"Slippery Slope",location:{lat:41.9239505,lng:-87.7001477},place_id:"ChIJdy7U9WLND4gRlsn7Bwe_NI8",foursquare_id:"5372cc32498ed9eb4bb2b3e4"},{title:"WhirlyBall Chicago",location:{lat:41.9213616,lng:-87.6801861},place_id:"ChIJ36q9du3SD4gRc_oBbj74Fm4",foursquare_id:"40b28c80f964a52065fc1ee3"}],fourSquareRating:function(e,r,t){data.locations[t].foursquare_rating=r?e.response.venue.rating:"NO RATING FOUND."}},stringHasText=function(e,r){return e=e||"",!(r.length>e.length)&&-1!==e.indexOf(r)},map,clientID="UUGLJUVJDKXWWANBKH1MEQFXPU4NR23AWMHCHORPC3K2THZI",clientSecret="ZSKC3L3IBME0TIQ2NDTOPRTWK0ZA4HENFBOTD0XJ3VVDLYPT",foursquareVersion="20171023",ViewModel=function(){var e=this;this.locationFilter=ko.observable(),this.items=ko.observableArray(data.locations),this.ph=ko.observable("Filter bars..."),this.filteredBars=ko.computed(function(){var e=this.locationFilter();return e?mapHandler.filterPage(ko.utils.arrayFilter(this.items(),function(r){return stringHasText(r.title.toLowerCase(),e.toLowerCase())})):mapHandler.filterPage(this.items())},this),this.reset=function(){e.locationFilter(null)}},mapHandler={bounds:null,infoWindow:null,map:null,markers:[],model:null,previousMarker:null,service:null,toggleBounce:function(e){null!==e.getAnimation()?e.setAnimation(null):e.setAnimation(google.maps.Animation.BOUNCE)},mouseEffect:function(e){for(var r=0;r<mapHandler.markers.length;r++)e.title===mapHandler.markers[r].title&&mapHandler.toggleBounce(mapHandler.markers[r])},loadInfo:function(e,r,t,n){null!==mapHandler.previousMarker&&(mapHandler.previousMarker.setIcon(null),mapHandler.previousMarker.setAnimation(null));var a='<div class="barContent">';r==google.maps.places.PlacesServiceStatus.OK&&(e.name?a+="<h3>"+e.name+"</h3>":a+="<h3>"+t.title+"</h3>",e.formatted_address?a+=e.formatted_address+"<br>":a+="<br>",e.formatted_phone_number?a+="<br><strong>Phone Number:</strong> "+e.formatted_phone_number+"<br>":a+="<br><strong>Phone Number</strong>: NONE<br>",e.opening_hours?a+="<br><strong>Hours:</strong><br>"+e.opening_hours.weekday_text[0]+"<br>"+e.opening_hours.weekday_text[1]+"<br>"+e.opening_hours.weekday_text[2]+"<br>"+e.opening_hours.weekday_text[3]+"<br>"+e.opening_hours.weekday_text[4]+"<br>"+e.opening_hours.weekday_text[5]+"<br>"+e.opening_hours.weekday_text[6]+"<br>":a+="<br>",e.rating?a+="<br><strong>Rating</strong>: "+e.rating+"<br>":a+="<br><strong>Rating</strong>: NONE<br>",data.locations.forEach(function(e){t.title==e.title&&(a+="<br><strong>Foursquare Rating:</strong> "+e.foursquare_rating+"<br>")}),e.website?a+='<br><a target="_blank" href="'+e.website+'">View Website</a><br>':a+="<br>No Website<br>",e.photos?a+='<br><img src="'+e.photos[0].getUrl({maxHeight:200,maxWidth:200})+'">':a+="<br>"),n.setContent(a),n.open(self.map,t),mapHandler.previousMarker=t},filterPage:function(e){var r=mapHandler,t=[];console.log(e),e.forEach(function(e){t.push(e.title)});for(var n=0;n<r.markers.length;n++)t.includes(r.markers[n].title)?r.markers[n].setVisible(!0):r.markers[n].setVisible(!1);return e},focusOnMarker:function(e){var r=mapHandler;if(null!==r.model&&r.model.reset(),null!==r.map)for(var t=new google.maps.LatLngBounds,n=0;n<r.markers.length;n++)"All bars"===e?(r.infoWindow.close(),r.markers[n].setVisible(!0),r.markers[n].setAnimation(null),r.markers[n].setIcon(null),t.extend(r.markers[n].position)):e.title===r.markers[n].title?(r.markers[n].setVisible(!0),t.extend(r.markers[n].position),r.toggleBounce(r.markers[n]),r.populateInfoWindow(r.markers[n],r.infoWindow)):r.markers[n].setVisible(!1)},populateInfoWindow:function(e,r){var t=this;if(r.marker!=e){r.marker=e;var n={placeId:e.place_id};t.service.getDetails(n,(n,a)=>t.loadInfo(n,a,e,r)),r.addListener("closeclick",function(){r.setMarker=null,e.setIcon(null),t.focusOnMarker("All bars"),t.map.fitBounds(t.bounds)})}},init:function(){var e=this;e.model=new ViewModel,ko.options.deferUpdates=!0,ko.applyBindings(this.model),e.map=new google.maps.Map(document.getElementById("map"),{center:{lat:41.9243734,lng:-87.6916102},zoom:12,mapTypeControl:!1}),e.service=new google.maps.places.PlacesService(e.map),e.infoWindow=new google.maps.InfoWindow,e.bounds=new google.maps.LatLngBounds;var r=0;data.locations.forEach(function(t){var n=new google.maps.Marker({map:e.map,position:t.location,title:t.title,animation:google.maps.Animation.DROP,place_id:t.place_id});$.ajax({url:"https://api.foursquare.com/v2/venues/"+t.foursquare_id+"?client_id="+clientID+"&client_secret="+clientSecret+"&v="+foursquareVersion,ratingResult:r}).done(function(e){data.fourSquareRating(e,!0,this.ratingResult)}).fail(function(){data.fourSquareRating(null,!1,this.ratingResult)}),r+=1,e.markers.push(n),n.addListener("click",function(){e.populateInfoWindow(this,e.infoWindow)}),e.bounds.extend(n.position)}),e.map.fitBounds(e.bounds)}};